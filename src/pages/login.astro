---
import BaseLayout from '~/layouts/BaseLayout.astro';

// Middleware (src/middleware.ts) already handles redirecting logged-in users away from /login.

let errorMessage: string | null = null;
const errorParam = Astro.url.searchParams.get('error');

if (errorParam) {
  switch (errorParam) {
    case 'invalid_credentials':
      errorMessage = "无效的用户名或密码。";
      break;
    case 'server_setup_issue_kv':
      errorMessage = "服务器配置错误：无法访问存储服务。";
      break;
    case 'server_setup_issue_auth':
      errorMessage = "服务器配置错误：认证凭据未设置。";
      break;
    case 'session_creation_failed':
      errorMessage = "登录失败：无法创建会话，请稍后重试。";
      break;
    default:
      errorMessage = "发生未知错误，请稍后重试。";
  }
}
---

<BaseLayout title="登录 - ImgBed">
  <main class="container mx-auto p-4 md:p-8 flex items-center justify-center min-h-[calc(100vh-100px)]">
    <div class="w-full max-w-md">
      <h1 class="text-3xl font-bold mb-8 text-center">登录到 ImgBed</h1>
      
      {errorMessage && (
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
          <span class="block sm:inline">{errorMessage}</span>
        </div>
      )}

      <form method="POST" action="/api/auth/login" class="bg-background border border-border rounded-lg shadow p-6 md:p-8 space-y-6">
        <div>
          <label for="username" class="block text-sm font-medium mb-1">用户名</label>
          <input 
            type="text" 
            id="username" 
            name="username" 
            required 
            class="w-full p-2 border border-border rounded-md focus:ring-text focus:border-text" 
          />
        </div>
        
        <div>
          <label for="password" class="block text-sm font-medium mb-1">密码</label>
          <input 
            type="password" 
            id="password" 
            name="password" 
            required 
            class="w-full p-2 border border-border rounded-md focus:ring-text focus:border-text" 
          />
        </div>
        
        <button type="submit" class="w-full bg-text text-background py-2 px-4 rounded-md hover:opacity-90 transition-opacity">
          登录
        </button>
      </form>
      <p class="text-center text-sm text-gray-500 mt-6">
        忘记密码了？请检查您的环境变量配置。
      </p>
    </div>
  </main>
</BaseLayout>
